<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <title>User</title>
  <meta name="description" content="#" />
  <link rel="stylesheet" href="dist/css/grayshift.css" />
  <link rel="stylesheet" href="dist/css/custom.css" />
  <link rel="stylesheet" href="https://rsms.me/inter/inter.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/masonry/4.2.2/masonry.pkgd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js"></script>
  <script src="config.js"></script>
</head>

<body>
  <div id="navigation"></div>
  <div class="container-fluid px-lg-12 px-0 pt-3 py-5 nav-bg-light shadow">
    <div class="container">
      <div class="row">
        <div class="col-5 col-sm-4 col-md-3 col-xl-2 text-center align-self-center">
          <img class="avatar-xxl avatar rounded-circle" id="nav-avatar" alt="" width="100%" />
        </div>
        <div class="col-7 col-sm-8 col-md-9 col-xl-10 d-flex align-items-center">
          <div class="d-flex flex-column justify-content-center">
            <h4>
              <a href="#">Yuhao</a>
            </h4>
            <footer>yuhao1118</footer>
            <p class="mt-3">FRC TEAM 6766 & Durham University</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid px-xl-12 pt-3">
    <div class="col-md-12">
      <div class="row">
        <ul class="nav nav-tabs nav-justified nav-sm shadow" id="tablist" role="tablist" aria-orientation="horizontal">
          <li class="nav-item">
            <a class="nav-link active" data-filter="all" data-toggle="tab" href="#all" role="tab"
               aria-selected="true">Likes</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-filter="all" data-toggle="tab" href="#all" role="tab"
               aria-selected="true">Posts</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <div class="container-fluid px-xl-12 px-0 px-sm-3">
    <div class="grid pt-3">
      <div class="grid-sizer"></div>
      <div class="gutter-sizer"></div>
      <div class="grid-item d-none" id="grid-item-template">
        <div class="card shadow no-radius">
          <div class="card-body p-0">
            <a id="avatar-group" class="nav-link px-3 py-2 d-flex">
              <img class="avatar avatar-sm rounded-circle" width="100%" />
              <div class="mx-3 align-self-center">
                <h3 class="fs-xxs lh-sm"></h3>
                <small class="text-body mt-1"></small>
              </div>
            </a>
            <a id="img-modal" href="" data-toggle="modal">
              <div class="hover hover-2">
                <img id="grid-img" width="100%" alt="">
                <div class="hover-overlay z-index-lower">
                  <div class="hover-2-description px-3">
                    <small id="grid-comment" class="text-light"></small>
                  </div>
                </div>
              </div>
            </a>
            <div class="modal fade z-index-higher" tabindex="-1" role="dialog" aria-labelledby="modalLabel"
                 aria-hidden="true">
              <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
                <div class="modal-content">
                  <div class="modal-header px-3 py-2">
                    <a id="avatar-group" class="nav-link d-flex">
                      <img class="avatar avatar-sm rounded-circle" width="100%" />
                      <div class="mx-3 align-self-center">
                        <h3 class="fs-xxs lh-sm"></h3>
                        <small class="text-body mt-1"></small>
                      </div>
                    </a>
                    <button class="btn btn-sm btn-circle btn-neutral ml-auto" data-dismiss="modal"
                            type="button"
                            aria-label="Close">
                      <svg class="gi gi-close fs-sm" width="1em" height="1em" viewBox="0 0 24 24"
                           fill="currentColor"
                           xmlns="http://www.w3.org/2000/svg">
                        <path
                              d="M13.41 12l4.3-4.29a1 1 0 1 0-1.42-1.42L12 10.59l-4.29-4.3a1 1 0 0 0-1.42 1.42l4.3 4.29-4.3 4.29a1 1 0 0 0 0 1.42 1 1 0 0 0 1.42 0l4.29-4.3 4.29 4.3a1 1 0 0 0 1.42 0 1 1 0 0 0 0-1.42z" />
                      </svg>
                    </button>
                  </div>
                  <div class="modal-body bg-comment p-0">
                    <div class="hover hover-2">
                      <img id="grid-img" width="100%" alt="">
                      <div class="hover-overlay">
                        <div class="hover-2-description px-3">
                          <small id="grid-comment" class="text-light"></small>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer p-3">
                    <div class="d-flex">
                      <button id="like" class="btn d-flex link-body-danger">
                        <svg class="gi gi-heart-fill fs-sm mr-1" width="1em" height="1em"
                             viewBox="0 0 24 24"
                             fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path
                                d="M12 21a1 1 0 0 1-.71-.29l-7.77-7.78a5.26 5.26 0 0 1 0-7.4 5.24 5.24 0 0 1 7.4 0L12 6.61l1.08-1.08a5.24 5.24 0 0 1 7.4 0 5.26 5.26 0 0 1 0 7.4l-7.77 7.78A1 1 0 0 1 12 21z">
                          </path>
                        </svg>
                      </button>
                      <button id="download" class="btn d-flex link-body ml-3">
                        <svg class="gi gi-cloud-download-fill fs-sm mr-1" width="1em"
                             height="1em" viewBox="0 0 24 24"
                             fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path
                                d="M21.9 11c0-.11-.06-.22-.09-.33a4.17 4.17 0 0 0-.18-.57c-.05-.12-.12-.24-.18-.37s-.15-.3-.24-.44S21 9.08 21 9s-.2-.25-.31-.37-.21-.2-.32-.3L20 8l-.36-.24a3.68 3.68 0 0 0-.44-.23l-.39-.18a4.13 4.13 0 0 0-.5-.15 3 3 0 0 0-.41-.09h-.18A6 6 0 0 0 6.33 7h-.18a3 3 0 0 0-.41.09 4.13 4.13 0 0 0-.5.15l-.39.18a3.68 3.68 0 0 0-.44.23L4.05 8l-.37.31c-.11.1-.22.19-.32.3s-.21.25-.31.37-.18.23-.26.36-.16.29-.24.44-.13.25-.18.37a4.17 4.17 0 0 0-.18.57c0 .11-.07.22-.09.33A5.23 5.23 0 0 0 2 12a5.5 5.5 0 0 0 .09.91c0 .1.05.19.07.29a5.58 5.58 0 0 0 .18.58l.12.29a5 5 0 0 0 .3.56l.14.22a.56.56 0 0 0 .05.08L3 15a5 5 0 0 0 4 2 2 2 0 0 1 .59-1.41A2 2 0 0 1 9 15a1.92 1.92 0 0 1 1 .27V12a2 2 0 0 1 4 0v3.37a2 2 0 0 1 1-.27 2.05 2.05 0 0 1 1.44.61A2 2 0 0 1 17 17a5 5 0 0 0 4-2l.05-.05a.56.56 0 0 0 .05-.08l.14-.22a5 5 0 0 0 .3-.56l.12-.29a5.58 5.58 0 0 0 .18-.58c0-.1.05-.19.07-.29A5.5 5.5 0 0 0 22 12a5.23 5.23 0 0 0-.1-1z">
                          </path>
                          <path
                                d="M14.31 16.38L13 17.64V12a1 1 0 0 0-2 0v5.59l-1.29-1.3a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 21a1 1 0 0 0 .69-.28l3-2.9a1 1 0 1 0-1.38-1.44z">
                          </path>
                        </svg>
                      </button>
                      <button class="btn d-flex link-body ml-auto">
                        <svg class="gi gi-share-fill fs-sm" width="1em" height="1em"
                             viewBox="0 0 24 24"
                             fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                          <path
                                d="M18 15a3 3 0 0 0-2.1.86L8 12.34V12v-.33l7.9-3.53A3 3 0 1 0 15 6v.34L7.1 9.86a3 3 0 1 0 0 4.28l7.9 3.53V18a3 3 0 1 0 3-3z">
                          </path>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="d-flex p-3">
              <button id="like" class="btn d-flex link-body-danger">
                <svg class="gi gi-heart-fill fs-sm mr-1" width="1em" height="1em" viewBox="0 0 24 24"
                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path
                        d="M12 21a1 1 0 0 1-.71-.29l-7.77-7.78a5.26 5.26 0 0 1 0-7.4 5.24 5.24 0 0 1 7.4 0L12 6.61l1.08-1.08a5.24 5.24 0 0 1 7.4 0 5.26 5.26 0 0 1 0 7.4l-7.77 7.78A1 1 0 0 1 12 21z">
                  </path>
                </svg>
              </button>
              <button id="download" class="btn d-flex link-body ml-3">
                <svg class="gi gi-cloud-download-fill fs-sm mr-1" width="1em" height="1em"
                     viewBox="0 0 24 24"
                     fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                  <path
                        d="M21.9 11c0-.11-.06-.22-.09-.33a4.17 4.17 0 0 0-.18-.57c-.05-.12-.12-.24-.18-.37s-.15-.3-.24-.44S21 9.08 21 9s-.2-.25-.31-.37-.21-.2-.32-.3L20 8l-.36-.24a3.68 3.68 0 0 0-.44-.23l-.39-.18a4.13 4.13 0 0 0-.5-.15 3 3 0 0 0-.41-.09h-.18A6 6 0 0 0 6.33 7h-.18a3 3 0 0 0-.41.09 4.13 4.13 0 0 0-.5.15l-.39.18a3.68 3.68 0 0 0-.44.23L4.05 8l-.37.31c-.11.1-.22.19-.32.3s-.21.25-.31.37-.18.23-.26.36-.16.29-.24.44-.13.25-.18.37a4.17 4.17 0 0 0-.18.57c0 .11-.07.22-.09.33A5.23 5.23 0 0 0 2 12a5.5 5.5 0 0 0 .09.91c0 .1.05.19.07.29a5.58 5.58 0 0 0 .18.58l.12.29a5 5 0 0 0 .3.56l.14.22a.56.56 0 0 0 .05.08L3 15a5 5 0 0 0 4 2 2 2 0 0 1 .59-1.41A2 2 0 0 1 9 15a1.92 1.92 0 0 1 1 .27V12a2 2 0 0 1 4 0v3.37a2 2 0 0 1 1-.27 2.05 2.05 0 0 1 1.44.61A2 2 0 0 1 17 17a5 5 0 0 0 4-2l.05-.05a.56.56 0 0 0 .05-.08l.14-.22a5 5 0 0 0 .3-.56l.12-.29a5.58 5.58 0 0 0 .18-.58c0-.1.05-.19.07-.29A5.5 5.5 0 0 0 22 12a5.23 5.23 0 0 0-.1-1z">
                  </path>
                  <path
                        d="M14.31 16.38L13 17.64V12a1 1 0 0 0-2 0v5.59l-1.29-1.3a1 1 0 0 0-1.42 1.42l3 3A1 1 0 0 0 12 21a1 1 0 0 0 .69-.28l3-2.9a1 1 0 1 0-1.38-1.44z">
                  </path>
                </svg>
              </button>
              <button class="btn d-flex link-body ml-auto">
                <svg class="gi gi-share-fill fs-sm" width="1em" height="1em" viewBox="0 0 24 24"
                     fill="currentColor"
                     xmlns="http://www.w3.org/2000/svg">
                  <path
                        d="M18 15a3 3 0 0 0-2.1.86L8 12.34V12v-.33l7.9-3.53A3 3 0 1 0 15 6v.34L7.1 9.86a3 3 0 1 0 0 4.28l7.9 3.53V18a3 3 0 1 0 3-3z">
                  </path>
                </svg>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
</body>
<script>
  // load navbar
  $('#navigation').load('navbar.html', () => {
    fetch(base_url + "/user/bxzr32").then(usr => usr.json()).then(usr => {
      $('nav #nav-login-group').addClass("d-none");
      $('nav #nav-avatar-dropdown').show();
      $('[id=nav-avatar]').attr('src', usr.avatar);
      $('nav #profile').attr('href', '/user');
      $("#following").append(usr.following.length)
      $("#followers").append(usr.followers.length)
    })
  });

  const base_url = config.base_url;

  fetch(base_url + '/images')
    .then(res => res.json())
    .then(res => {
      let promises = [];
      for (item of res) {
        promises.push(
          Promise.resolve(item).then(item => fetch(base_url + `/user/${item.usr_id}`)
            .then(usr => usr.json())
            .then(usr => {
              let grid_item = $('#grid-item-template').clone();
              $(grid_item).attr('id', 'grid-' + item.id).removeClass('d-none');
              $(grid_item).find('#avatar-group').attr("href", "/user");
              $(grid_item).find('#avatar-group h3').append(usr.name);
              $(grid_item).find('#avatar-group small').append(usr.id);
              $(grid_item).find('#avatar-group img').attr('src', usr.avatar);
              $(grid_item).find('#grid-img').attr('src', item.url);
              $(grid_item).find('#img-modal').attr('data-target', '#' + item.id);
              $(grid_item).find('.modal,.fade').attr('id', item.id);
              $(grid_item).find('#grid-comment').append(item.comment);
              $(grid_item).find('#like').append(item.likes);
              $(grid_item).find('#download').append(item.downloads);
              $('.grid').append(grid_item);
            }))
        );
      }
      return Promise.all(promises);
    })
    .then(() => {
      $('.grid-item #like').click(event => {
        let _this = event.currentTarget;
        let id = $(_this)
          .parents('.grid-item')
          .attr('id');
        let like_btns = $(`#${id} #like svg`);

        like_btns.each((index, element) => {
          let svg = $(element).children('svg');
          if (svg.attr('fill') == 'currentColor') {
            svg.attr('fill', 'var(--danger)');
            $(element).css('color', 'var(--danger)');
          } else {
            svg.attr('fill', 'currentColor');
            $(element).css('color', 'currentColor');
          }
        });
      });
      var $grid = $('.grid').imagesLoaded(() => {
        $grid.masonry({
          itemSelector: '.grid-item',
          percentPosition: true,
          columnWidth: '.grid-sizer',
          gutter: '.gutter-sizer'
        });
      });
    });
</script>

</html>